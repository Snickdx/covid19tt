let selected,messaging,addModal,deleteModal;function registerSW(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("SW registered: ",e),firebase.messaging().useServiceWorker(e)}).catch(e=>{console.log("SW registration failed: ",e)})}function displayLastRecord(e){document.querySelector("#cases").innerHTML=e.cases.imported+e.cases.community,document.querySelector("#date").innerHTML=new Date(1e3*e.date).toLocaleDateString("en-US"),document.querySelector("#updateNum").innerHTML=e.updateNum}function displayMedia(e){let t="";for(let n of e)t+=`\n        <div class="card">\n            <div class="card-content black-text">\n                <span class="card-title">Update #: ${n.updateNum}</span>\n                <p>Date: ${new Date(1e3*n.date).toLocaleDateString("en-US")}</p>\n                <p>Tested: ${n.tested}</p>\n                <p>Contact: ${n.contact}</p>\n                <p>Imported Cases: ${n.cases.imported}</p>\n                <p>Community Cases: ${n.cases.community}</p>\n            </div>\n            <div class="card-action">\n                <a href="${n.url}" rel="noopener" target="_blank" style="font-weight: 700" class="red-text darken-2">View on Facebook</a>\n                <a href="#deleteModal" class="modal-trigger red-text darken-2" onclick="selected = ${n.id}" style="font-weight: 700">Delete</a>\n            </div>\n        </div>\n        `;document.querySelector("#media-list").innerHTML=t}function fixAccessbility(){let e=document.querySelector(".highslide-container>img");e.setAttribute("alt","highslide container image"),e.setAttribute("aria-hidden",!0)}function postData(e){getData()}function deleteData(){getData()}function createReport(e){e.preventDefault();let t=e.target.elements;postData({password:t.password,updateNum:t.updateNum,url:t.url,date:t.date,cases:{deaths:t.deaths,imported:t.imported,community:t.community},tested:t.tested})}function deleteReport(e){console.log(selected),e.preventDefault();let t=e.target.elements;deleteData({id:selected,password:t.password})}function getData(){let e=getReports();displayLineChart(e);let t=e.reverse()[0];displayMedia(e),displayPieChart(t),displayLastRecord(t)}async function requestNotifications(){try{await messaging.requestPermission();const e=await messaging.getToken();console.log(e)}catch(e){console.error(e)}}async function getMsgToken(){try{const e=await messaging.getToken();if(e)return e;console.log("No Instance ID token available. Request permission to generate one.")}catch(e){console.log("An error occurred while retrieving token. ",err),showToken("Error retrieving Instance ID token. ",err)}}async function tokenRefresh(){try{await messaging.getToken()}catch(e){console.log("Unable to retrieve refreshed token ",err)}}function toggleMsg(e){e.target.checked&&requestNotifications()}async function foregroundMsg(e){console.log("Message: ",e)}function toast(e){M.toast({html:e})}function main(){(messaging=firebase.messaging()).usePublicVapidKey("BAqoB57ExCmPU2hHer0NWSqTsHgAABG78b0IB_KkAqfAg63k9MG8Q8vqXETs0wDcBckFbsTUs191L39nW7M-EsU"),messaging.onTokenRefresh(tokenRefresh),messaging.onMessage(foregroundMsg),document.querySelector("#msgEnabled").addEventListener("click",toggleMsg),document.forms.createForm.addEventListener("submit",createReport),document.forms.deleteForm.addEventListener("submit",deleteReport),getData(),fixAccessbility(),registerSW()}addModal=M.Modal.init(document.querySelector("#addModal")),deleteModal=M.Modal.init(document.querySelector("#deleteModal"),{onOpenStart:function(){document.querySelector("#selected").innerHTML=selected}}),M.Tabs.init(document.querySelector(".tabs")),window.addEventListener("load",main);